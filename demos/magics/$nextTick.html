<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$nextTick Magic Demo</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .demo { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .explanation { background: #e3f2fd; padding: 15px; margin: 10px 0; border-left: 4px solid #2196f3; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .box { background: white; padding: 15px; margin: 10px 0; border-radius: 4px; border: 1px solid #ddd; }
        a { display: inline-block; margin-top: 20px; color: #2196f3; }
    </style>
</head>
<body>
    <h1>$nextTick Magic Property</h1>

    <div class="explanation">
        <strong>What is $nextTick?</strong>
        <p>$nextTick waits for the next DOM update cycle before executing code. Essential when you need to access DOM elements after reactive data changes.</p>
    </div>

    <h2>Example 1: Focus After Showing Element</h2>
    <div class="demo" x-data="{ show: false }">
        <button @click="show = true; $nextTick(() => $refs.input.focus())">Show and Focus Input</button>
        <div x-show="show" x-transition class="box">
            <input type="text" x-ref="input" placeholder="This will be auto-focused">
        </div>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> Without $nextTick, focus() would fail because element isn't in DOM yet. $nextTick waits for DOM update.
    </div>

    <h2>Example 2: Measure Element After Rendering</h2>
    <div class="demo" x-data="{
        items: [],
        height: 0,
        addItem() {
            this.items.push(`Item ${this.items.length + 1}`);
            this.$nextTick(() => {
                this.height = this.$refs.list.offsetHeight;
            });
        }
    }">
        <button @click="addItem()">Add Item</button>
        <ul x-ref="list" class="box">
            <template x-for="item in items" :key="item">
                <li x-text="item" style="padding: 10px;"></li>
            </template>
        </ul>
        <p>List height: <span x-text="height"></span>px</p>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick ensures DOM is updated before measuring. Height is accurate after new item renders.
    </div>

    <h2>Example 3: Scroll to Bottom After Adding Content</h2>
    <div class="demo" x-data="{
        messages: ['Message 1', 'Message 2'],
        addMessage() {
            this.messages.push(`Message ${this.messages.length + 1}`);
            this.$nextTick(() => {
                this.$refs.chat.scrollTop = this.$refs.chat.scrollHeight;
            });
        }
    }">
        <div x-ref="chat" style="height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: white;">
            <template x-for="msg in messages" :key="msg">
                <div style="padding: 10px; margin: 5px 0; background: #f0f0f0; border-radius: 4px;" x-text="msg"></div>
            </template>
        </div>
        <button @click="addMessage()">Add Message</button>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick waits for message to render before scrolling. Ensures scroll reaches actual bottom.
    </div>

    <h2>Example 4: Update Input Value After Model Change</h2>
    <div class="demo" x-data="{
        value: '',
        setValue(text) {
            this.value = text;
            this.$nextTick(() => {
                this.$refs.input.setSelectionRange(0, this.value.length);
            });
        }
    }">
        <input type="text" x-ref="input" x-model="value" style="width: 100%; padding: 10px;">
        <button @click="setValue('Hello World!')">Set and Select Text</button>
        <button @click="setValue('Alpine.js is awesome!')">Set Different Text</button>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick ensures input value is updated before selection is set.
    </div>

    <h2>Example 5: Conditional Rendering with DOM Access</h2>
    <div class="demo" x-data="{
        showBox: false,
        boxInfo: ''
    }">
        <button @click="
            showBox = true;
            $nextTick(() => {
                boxInfo = `Box dimensions: ${$refs.box.offsetWidth}x${$refs.box.offsetHeight}`;
            });
        ">Show Box and Get Info</button>

        <div x-show="showBox" x-ref="box" class="box" style="width: 300px; height: 100px;">
            This is a box!
        </div>

        <p x-show="boxInfo" x-text="boxInfo"></p>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick waits for x-show to render before accessing element dimensions.
    </div>

    <h2>Example 6: Chart Update After Data Change</h2>
    <div class="demo" x-data="{
        data: [10, 20, 30, 40],
        updateChart() {
            this.data = this.data.map(v => Math.floor(Math.random() * 100));
            this.$nextTick(() => {
                const bars = this.$refs.chart.querySelectorAll('.bar');
                bars.forEach((bar, i) => {
                    bar.style.height = this.data[i] + '%';
                });
            });
        }
    }" x-init="updateChart()">
        <div x-ref="chart" style="display: flex; align-items: flex-end; height: 200px; gap: 10px; padding: 10px; background: white; border: 1px solid #ddd;">
            <template x-for="(value, index) in data" :key="index">
                <div class="bar" style="flex: 1; background: #2196f3; transition: height 0.3s;"></div>
            </template>
        </div>
        <button @click="updateChart()">Update Chart</button>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick waits for bars to render before animating heights. Smooth visual updates.
    </div>

    <h2>Example 7: Multiple nextTick Calls</h2>
    <div class="demo" x-data="{
        logs: [],
        runSequence() {
            this.logs.push('1: Synchronous code');

            this.$nextTick(() => {
                this.logs.push('2: First nextTick');

                this.$nextTick(() => {
                    this.logs.push('3: Second nextTick');
                });
            });

            this.logs.push('4: More synchronous code');
        }
    }">
        <button @click="runSequence()">Run Sequence</button>
        <button @click="logs = []">Clear</button>

        <div class="box">
            <h4>Execution Order:</h4>
            <ol style="margin: 0;">
                <template x-for="(log, index) in logs" :key="index">
                    <li x-text="log"></li>
                </template>
            </ol>
        </div>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> Multiple $nextTick calls can be chained. Shows execution order: sync code, first tick, second tick.
    </div>

    <h2>Example 8: Form Auto-Submit After Validation</h2>
    <div class="demo" x-data="{
        email: '',
        isValid: false,
        submitted: false,
        validate() {
            this.isValid = this.email.includes('@');
            if (this.isValid) {
                this.$nextTick(() => {
                    this.submitted = true;
                });
            }
        }
    }">
        <input type="email" x-model="email" placeholder="Enter email" style="display: block; width: 100%; padding: 10px; margin: 10px 0;">
        <button @click="validate()">Validate and Submit</button>

        <div x-show="!isValid && email.length > 0" class="box" style="background: #ffebee;">
            Invalid email format
        </div>

        <div x-show="submitted" x-transition class="box" style="background: #e8f5e9;">
            Form submitted successfully!
        </div>
    </div>
    <div class="explanation">
        <strong>Explanation:</strong> $nextTick delays submission until validation completes and DOM updates.
    </div>

    <a href="../../index.html">‚Üê Back to All Demos</a>
</body>
</html>
